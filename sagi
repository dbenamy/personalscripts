#!/usr/bin/env bash
# sudo apt-get update ; sudo apt-get install

CURRDIR=$(pwd)

if [[ -z "$PERS_DIR" ]]
then
    PERS_DIR="$HOME/pers"
fi



SAGIRECORD_DIR="$PERS_DIR/machines/apt/$(hostname)"

if [ ! -d $SAGIRECORD_DIR ]
then
    echo "[sagi] $SAGIRECORD_DIR does not exist: creating."
    mkdir -p $SAGIRECORD_DIR
    cd $SAGIRECORD_DIR
    git init
fi

sudo apt-get update

sudo apt-get install "$@" && ( 
    cd "$SAGIRECORD_DIR" &&
    dpkg --get-selections > aptlist.txt &&
    git add aptlist.txt &&
    git commit -m "$(hostname) $*"
)
        
cd "$CURRDIR"
    
